<section class="publicaciones-container">

  @if (publicaciones.length === 0) {
    <p class="no-publicaciones">No hay publicaciones reportadas para mostrar.</p>
  } @else {
    @for (publicacion of publicaciones; track publicacion.id!) {
      <article class="publicacion-card">

        <div class="publicacion-header" (click)="irAPerfilProfesional(publicacion.idCreador)">
          <div class="creador-info">
            @if (getUsuarioProfesionalById(publicacion.idCreador)) {
              <img
                [src]="imagenesPerfil[publicacion.idCreador] || 'public/avatar.png'"
                [alt]="'Foto de ' + getUsuarioProfesionalById(publicacion.idCreador)!.nombreCompleto"
                class="creador-foto"
                loading="lazy"
              />
              <div class="usuario-details">
                <h3>{{ getUsuarioProfesionalById(publicacion.idCreador)!.nombreCompleto }}</h3>
              </div>
            } @else {
              <span class="loading-text">Cargando profesional...</span>
            }
          </div>
        </div>

        <div class="publicacion-content">
          <p>{{ publicacion.cont }}</p>

          @if (publicacion.urlFoto && imagenPublicacion[publicacion.id!]) {
            <div class="publicacion-imagen">
              <img
                [src]="imagenPublicacion[publicacion.id!]"
                [alt]="'Imagen de la publicación de ' + getUsuarioProfesionalById(publicacion.idCreador)?.nombreCompleto"
                loading="lazy"
              />
            </div>
          }
        </div>

        <div class="motivo-container">
          <textarea
            [formControl]="motivoControls[publicacion.id!]"
            placeholder="Motivo de eliminación (50-200 caracteres, sin espacios en blanco)"
            class="motivo-input"
            rows="3"
          ></textarea>

          @if (motivoControls[publicacion.id!].touched && motivoControls[publicacion.id!].invalid) {
            <small class="error-text">
              @if (motivoControls[publicacion.id!].errors?.['required']) {
                El motivo es obligatorio.
              } @else if (motivoControls[publicacion.id!].errors?.['minlength']) {
                Mínimo 50 caracteres.
              } @else if (motivoControls[publicacion.id!].errors?.['maxlength']) {
                Máximo 200 caracteres.
              } @else if (motivoControls[publicacion.id!].errors?.['noWhitespace']) {
                No puede contener solo espacios.
              }
            </small>
          }
        </div>

        <div class="publicacion-actions" (click)="$event.stopPropagation()">
          <button class="approve-button" (click)="controlar(publicacion, 'aprobar')">
            Aprobar
            <span class="action-label">Aprobar</span>
          </button>
          <button
            class="delete-button"
            (click)="controlar(publicacion, 'eliminar')"
            [disabled]="motivoControls[publicacion.id!].invalid"
          >
            Eliminar
            <span class="action-label">Eliminar</span>
          </button>
        </div>
      </article>
    }
  }
</section>
